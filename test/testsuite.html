<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RNG Comparison - ntrpRNG vs cgRNDV v1.1</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Courier New', monospace;
      background: #0a0e27;
      color: #00ff41;
      padding: 20px;
      line-height: 1.6;
      font-size: 1.25em;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: #0f1419;
      border: 2px solid #00ff41;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 24px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    .subtitle {
      text-align: center;
      margin-bottom: 30px;
      font-size: 13px;
      color: #88ff88;
    }
    .rng-selector {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-bottom: 20px;
    }
    .rng-btn {
      padding: 15px;
      background: #1a1f2e;
      color: #00ff41;
      border: 2px solid #00ff41;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
      text-transform: uppercase;
    }
    .rng-btn:hover {
      background: #2a2f3e;
      transform: scale(1.02);
    }
    .rng-btn.active {
      background: #00ff41;
      color: #0a0e27;
      font-weight: bold;
    }
    .settings-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    .input-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-size: 13px;
    }
    input, select {
      width: 100%;
      padding: 10px;
      background: #1a1f2e;
      border: 1px solid #00ff41;
      color: #00ff41;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      border-radius: 4px;
    }
    input:focus, select:focus {
      outline: none;
      box-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
    }
    button.main-btn {
      width: 100%;
      padding: 15px;
      background: #00ff41;
      color: #0a0e27;
      border: none;
      font-family: 'Courier New', monospace;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 4px;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s;
      margin-bottom: 10px;
    }
    button.main-btn:hover:not(:disabled) {
      background: #00cc33;
      box-shadow: 0 0 15px rgba(0, 255, 65, 0.6);
    }
    button.main-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .quick-settings {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    .quick-btn {
      padding: 12px;
      background: #1a1f2e;
      color: #00ff41;
      border: 2px solid #00ff41;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
    }
    .quick-btn:hover {
      background: #00ff41;
      color: #0a0e27;
      transform: scale(1.02);
    }
    .quick-btn.active {
      background: #00ff41;
      color: #0a0e27;
    }
    .status {
      margin-top: 30px;
      padding: 20px;
      background: #1a1f2e;
      border-left: 4px solid #00ff41;
      border-radius: 4px;
      min-height: 100px;
    }
    .status.hidden {
      display: none;
    }
    .status h2 {
      font-size: 16px;
      margin-bottom: 15px;
      text-transform: uppercase;
    }
    .status p {
      margin: 8px 0;
      font-size: 14px;
    }
    .progress {
      margin: 15px 0;
    }
    .progress-bar {
      width: 100%;
      height: 20px;
      background: #0a0e27;
      border: 1px solid #00ff41;
      border-radius: 4px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #00ff41, #00cc33);
      width: 0%;
      transition: width 0.3s;
    }
    .results-comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    .result {
      padding: 15px;
      background: #0a0e27;
      border: 2px solid #00ff41;
      border-radius: 4px;
    }
    .result h3 {
      margin-bottom: 15px;
      font-size: 16px;
      text-transform: uppercase;
      border-bottom: 1px solid #00ff41;
      padding-bottom: 8px;
      text-align: center;
    }
    .result-row {
      display: grid;
      grid-template-columns: 140px 1fr 90px;
      gap: 8px;
      margin: 10px 0;
      padding: 8px;
      background: #1a1f2e;
      border-radius: 4px;
      align-items: center;
    }
    .result-label {
      font-weight: bold;
      font-size: 11px;
      word-wrap: break-word;
    }
    .result-value {
      font-size: 14px;
      font-weight: bold;
      text-align: center;
    }
    .result-quality {
      font-size: 10px;
      text-align: right;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .result-good {
      color: #00ff41;
    }
    .result-fair {
      color: #ffaa00;
    }
    .result-poor {
      color: #ff4400;
    }
    .winner-badge {
      display: inline-block;
      padding: 2px 8px;
      background: #ffaa00;
      color: #0a0e27;
      border-radius: 3px;
      font-size: 10px;
      font-weight: bold;
      margin-left: 5px;
    }
    .info {
      margin-top: 15px;
      background: #1a1f2e;
      border-radius: 4px;
      font-size: 1em;
      color: #88ff88;
      border: 1px solid #00ff41;
    }
    .info-header {
      padding: 12px;
      cursor: pointer;
      font-weight: bold;
    }
    .info-header::before {
      content: '‚ñ∫ ';
      display: inline-block;
      transition: transform 0.2s;
    }
    .info.open .info-header::before {
      transform: rotate(90deg);
    }
    .info-content {
      padding: 0 12px 12px 12px;
      display: none;
      border-top: 1px solid #00ff41;
      margin-top: 10px;
      padding-top: 10px;
    }
    .info.open .info-content {
      display: block;
    }
    .spinner {
      display: inline-block;
      width: 12px;
      height: 12px;
      border: 2px solid rgba(0, 255, 65, 0.3);
      border-top-color: #00ff41;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .entropy-collector {
      padding: 20px;
      background: #1a1f2e;
      border: 2px solid #ffaa00;
      border-radius: 4px;
      margin-bottom: 20px;
      display: none;
    }
    .entropy-collector.active {
      display: block;
    }
    .entropy-title {
      font-size: 16px;
      text-align: center;
      margin-bottom: 15px;
      color: #ffaa00;
      text-transform: uppercase;
    }
    .entropy-bar-container {
      width: 100%;
      height: 40px;
      background: #0a0e27;
      border: 2px solid #00ff41;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
      margin-bottom: 15px;
    }
    .entropy-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #ff4400, #ffaa00, #00ff41);
      width: 0%;
      transition: width 0.1s linear;
    }
    .entropy-bar-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 18px;
      font-weight: bold;
      color: #00ff41;
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
      z-index: 10;
    }
    .entropy-stats {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 15px;
      text-align: center;
      font-size: 12px;
      margin-bottom: 15px;
    }
    .entropy-stat {
      padding: 10px;
      background: #0a0e27;
      border-radius: 4px;
      border: 1px solid #00ff41;
    }
    .entropy-stat-value {
      font-size: 20px;
      font-weight: bold;
      color: #00ff41;
      display: block;
      margin-bottom: 5px;
    }
    .entropy-stat-label {
      color: #88ff88;
      font-size: 11px;
    }
    .entropy-breakdown {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }
    .entropy-type {
      padding: 8px;
      background: #0a0e27;
      border-radius: 4px;
      border: 1px solid #00ff41;
      text-align: center;
    }
    .entropy-type-label {
      font-size: 10px;
      color: #88ff88;
      display: block;
      margin-bottom: 3px;
    }
    .entropy-type-value {
      font-size: 16px;
      font-weight: bold;
      color: #00ff41;
      display: block;
    }
    .entropy-type-weight {
      font-size: 9px;
      color: #ffaa00;
      display: block;
      margin-top: 2px;
    }
    .entropy-message {
      text-align: center;
      margin-top: 15px;
      font-size: 14px;
      color: #ffaa00;
      font-weight: bold;
    }
    .entropy-message.good {
      color: #00ff41;
    }
    .entropy-notice {
      padding: 12px;
      background: #2a2f3e;
      border: 1px solid #ffaa00;
      border-radius: 4px;
      margin-bottom: 20px;
      color: #ffaa00;
      font-size: 12px;
      text-align: center;
    }
    .entropy-notice.hidden {
      display: none;
    }
    .tooltip {
      position: relative;
      display: inline-block;
      cursor: help;
      color: #ffaa00;
      margin-left: 5px;
    }
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 300px;
      background-color: #1a1f2e;
      color: #00ff41;
      text-align: left;
      border-radius: 4px;
      padding: 10px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -150px;
      opacity: 0;
      transition: opacity 0.3s;
      border: 1px solid #00ff41;
      font-size: 11px;
      line-height: 1.4;
    }
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    @media (max-width: 768px) {
      body {
        padding: 10px;
        font-size: 1em;
      }
      .container {
        padding: 15px;
      }
      h1 {
        font-size: 18px;
        letter-spacing: 1px;
      }
      .subtitle {
        font-size: 11px;
      }
      .rng-selector,
      .quick-settings,
      .settings-grid,
      .results-comparison {
        grid-template-columns: 1fr;
      }
      .entropy-stats,
      .entropy-breakdown {
        grid-template-columns: repeat(2, 1fr);
      }
      .entropy-breakdown .entropy-type:last-child {
        grid-column: span 2;
      }
      .result-row {
        grid-template-columns: 1fr;
        text-align: center;
        gap: 5px;
      }
      .result-label {
        font-size: 12px;
      }
      .result-value {
        font-size: 16px;
      }
      .result-quality {
        font-size: 11px;
        text-align: center;
      }
      .rng-btn, .quick-btn {
        font-size: 12px;
        padding: 10px;
      }
      .main-btn {
        font-size: 14px;
      }
      input, select {
        font-size: 12px;
      }
      label {
        font-size: 12px;
      }
      .tooltip .tooltiptext {
        width: 250px;
        margin-left: -125px;
        font-size: 10px;
      }
      .entropy-bar-text {
        font-size: 14px;
      }
      .entropy-title {
        font-size: 14px;
      }
      .info-content {
        font-size: 11px;
      }
    }

    @media (max-width: 480px) {
      body {
        font-size: 0.9em;
      }
      h1 {
        font-size: 16px;
      }
      .entropy-stats,
      .entropy-breakdown {
        grid-template-columns: 1fr;
      }
      .entropy-breakdown .entropy-type:last-child {
        grid-column: span 1;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚ö° RNG Comparison Test Suite v1.1‚ö°</h1>
    <div class="subtitle">Compare ntrpRNG (Behavioral) vs cgRNDV (Pure Crypto) - Enhanced with Weighted Event Tracking</div>
    
    <div class="rng-selector">
      <button class="rng-btn active" data-mode="ntrpRNG" onclick="selectRNG('ntrpRNG')">üéØ ntrpRNG Only</button>
      <button class="rng-btn" data-mode="cgRNDV" onclick="selectRNG('cgRNDV')">üé≤ cgRNDV Only</button>
      <button class="rng-btn" data-mode="both" onclick="selectRNG('both')">‚öîÔ∏è Compare Both</button>
    </div>
    
    <div class="quick-settings">
      <button class="quick-btn active" onclick="applyPreset('fast')">‚ö° FAST</button>
      <button class="quick-btn" onclick="applyPreset('balanced')">‚öñÔ∏è BALANCED</button>
      <button class="quick-btn" onclick="applyPreset('secure')">üîí SECURE</button>
    </div>

    <div class="settings-grid">
      <div class="input-group">
        <label for="datasetSize">Dataset Size (KB):</label>
        <input type="number" id="datasetSize" value="64" min="1" max="10240">
      </div>
      <div class="input-group" id="iterationsGroup">
        <label for="iterations">Hash Iterations:</label>
        <input type="number" id="iterations" value="1000" min="100" max="50000">
      </div>
      <div class="input-group" id="saltSizeGroup">
        <label for="saltSize">Salt Size (bytes):</label>
        <input type="number" id="saltSize" value="32" min="16" max="128">
      </div>
    </div>

    <div id="entropyNotice" class="entropy-notice">
      üí° ntrpRNG requires 500 weighted events (~5-10s interaction)
      <span class="tooltip">‚ÑπÔ∏è
        <span class="tooltiptext">
          <strong>Event Weights:</strong><br>
          ‚Ä¢ Keyboard: √ó3 (high entropy)<br>
          ‚Ä¢ Mouse Down/Touch/Motion: √ó2<br>
          ‚Ä¢ Mouse Move/Scroll: √ó1<br><br>
          Example: 100 keyboard + 200 mouse = 500 weighted events
        </span>
      </span>
    </div>
    
    <div id="entropyCollector" class="entropy-collector">
      <div class="entropy-title">üéØ Collecting Entropy - Interact With Page!</div>
      <div class="entropy-bar-container">
        <div id="entropyBarFill" class="entropy-bar-fill"></div>
        <div id="entropyBarText" class="entropy-bar-text">0 / 500</div>
      </div>
      
      <div class="entropy-breakdown">
        <div class="entropy-type">
          <span class="entropy-type-label">KEYBOARD</span>
          <span id="eventKeyboard" class="entropy-type-value">0</span>
          <span class="entropy-type-weight">weight: √ó3</span>
        </div>
        <div class="entropy-type">
          <span class="entropy-type-label">MOUSE</span>
          <span id="eventMouse" class="entropy-type-value">0</span>
          <span class="entropy-type-weight">weight: √ó1-2</span>
        </div>
        <div class="entropy-type">
          <span class="entropy-type-label">TOUCH</span>
          <span id="eventTouch" class="entropy-type-value">0</span>
          <span class="entropy-type-weight">weight: √ó1-2</span>
        </div>
        <div class="entropy-type">
          <span class="entropy-type-label">SCROLL</span>
          <span id="eventScroll" class="entropy-type-value">0</span>
          <span class="entropy-type-weight">weight: √ó1</span>
        </div>
        <div class="entropy-type">
          <span class="entropy-type-label">OTHER</span>
          <span id="eventOther" class="entropy-type-value">0</span>
          <span class="entropy-type-weight">weight: √ó2</span>
        </div>
      </div>
      
      <div class="entropy-stats">
        <div class="entropy-stat">
          <span id="entropyWeighted" class="entropy-stat-value">0</span>
          <span class="entropy-stat-label">Weighted Events</span>
        </div>
        <div class="entropy-stat">
          <span id="entropyRate" class="entropy-stat-value">0</span>
          <span class="entropy-stat-label">Events/sec</span>
        </div>
        <div class="entropy-stat">
          <span id="entropyETA" class="entropy-stat-value">~0s</span>
          <span class="entropy-stat-label">Est. Time</span>
        </div>
      </div>
      <div id="entropyMessage" class="entropy-message">üí° Tip: Use keyboard for fastest collection (√ó3 weight)</div>
    </div>
    
    <button class="main-btn" id="startBtn" onclick="runTest()">Start Test</button>
    
    <div id="status" class="status hidden">
      <h2 id="statusTitle">Status</h2>
      <p id="statusText">Initializing...</p>
      <div class="progress">
        <div class="progress-bar">
          <div id="progressFill" class="progress-fill"></div>
        </div>
      </div>
      <div id="resultContainer"></div>
    </div>
    
    <div class="info" id="infoBox">
      <div class="info-header" onclick="toggleInfoBox()">
        Information & Test Scales
      </div>
      <div class="info-content">
        <strong>RNG Types:</strong><br>
        ‚Ä¢ <strong>ntrpRNG v1.3.0</strong>: Behavioral entropy (weighted events) + crypto.getRandomValues() + salt + 5000 iterations<br>
        ‚Ä¢ <strong>cgRNDV v1.1.0</strong>: Pure crypto.getRandomValues() only<br>
        ‚Ä¢ <strong>Compare Both</strong>: Side-by-side statistical comparison<br><br>
        
        <strong>Weighted Event System (ntrpRNG):</strong><br>
        ‚Ä¢ <strong>Keyboard events</strong>: √ó3 weight (highest entropy: timing + key choice)<br>
        ‚Ä¢ <strong>Mouse down/Touch/Motion</strong>: √ó2 weight (medium entropy)<br>
        ‚Ä¢ <strong>Mouse move/Scroll</strong>: √ó1 weight (basic entropy)<br>
        ‚Ä¢ <strong>Target</strong>: 500 weighted events (hardcoded for security)<br>
        ‚Ä¢ <strong>Example</strong>: 100 keyboard + 100 mouse down + 100 mouse move = 100√ó3 + 100√ó2 + 100√ó1 = 600 weighted events ‚úì<br><br>
        
        <strong>Quick Settings:</strong><br>
        ‚Ä¢ <strong>FAST</strong>: 1K iterations (testing/dev)<br>
        ‚Ä¢ <strong>BALANCED</strong>: 5K iterations (recommended)<br>
        ‚Ä¢ <strong>SECURE</strong>: 10K iterations (production)<br><br>
        
        <strong>Parameter Ranges:</strong><br>
        ‚Ä¢ <strong>Dataset Size (KB)</strong>: 1 - 10240<br>
        ‚Ä¢ <strong>Hash Iterations</strong>: 100 - 50000<br>
        ‚Ä¢ <strong>Salt Size (bytes)</strong>: 16 - 128<br><br>
        
        <strong>Test Quality Scales:</strong><br>
        ‚Ä¢ Shannon Entropy: 7.9-8.0=Excellent | 7.5-7.9=Good | 7.0-7.5=Fair | <7.0=Poor<br>
        ‚Ä¢ Monobit/Runs: 0-1.0=Excellent | 1.0-2.0=Good | 2.0-3.0=Fair | >3.0=Poor<br>
        ‚Ä¢ Chi-Square: <250=Excellent | 250-293.25=Good | 293.25-350=Fair | >350=Poor<br>
        ‚Ä¢ Serial Correlation: <0.05=Excellent | 0.05-0.1=Good | 0.1-0.2=Fair | >0.2=Poor<br>
        ‚Ä¢ Avalanche Effect: 45-55%=Excellent | 40-60%=Good | 35-65%=Fair | else=Poor<br><br>
        
        <strong>Security Notes:</strong><br>
        ‚Ä¢ ntrpRNG v1.3.0 uses hardcoded 500 minimum events (cannot be overridden)<br>
        ‚Ä¢ Dual-path XOR fortification mixes behavioral + CSPRNG entropy<br>
        ‚Ä¢ Asynchronous batching prevents UI blocking during 5000 iterations
      </div>
    </div>
  </div>

  <script src="../src/ntrpRNG.js"></script>
  <script src="cgRNDV.js"></script>
  <script src="ntrpRNGDev.js"></script>
  <script>
    let currentMode = 'ntrpRNG';

    const presets = {
      fast: { iterations: 1000, saltSize: 32 },
      balanced: { iterations: 5000, saltSize: 32 },
      secure: { iterations: 10000, saltSize: 64 }
    };

    function selectRNG(mode) {
      currentMode = mode;
      document.querySelectorAll('.rng-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.mode === mode);
      });

      const notice = document.getElementById('entropyNotice');
      notice.classList.toggle('hidden', mode === 'cgRNDV');

      const iterationsGroup = document.getElementById('iterationsGroup');
      const saltSizeGroup = document.getElementById('saltSizeGroup');
      
      if (mode === 'cgRNDV') {
        iterationsGroup.style.opacity = '0.5';
        iterationsGroup.style.pointerEvents = 'none';
        saltSizeGroup.style.opacity = '0.5';
        saltSizeGroup.style.pointerEvents = 'none';
      } else {
        iterationsGroup.style.opacity = '1';
        iterationsGroup.style.pointerEvents = 'auto';
        saltSizeGroup.style.opacity = '1';
        saltSizeGroup.style.pointerEvents = 'auto';
      }
    }

    function applyPreset(preset) {
      const config = presets[preset];
      document.getElementById('iterations').value = config.iterations;
      document.getElementById('saltSize').value = config.saltSize;

      document.querySelectorAll('.quick-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
    }

    function updateStatus(title, text, progress = null) {
      const statusDiv = document.getElementById('status');
      statusDiv.classList.remove('hidden');
      document.getElementById('statusTitle').textContent = title;
      document.getElementById('statusText').innerHTML = text;
      
      if (progress !== null) {
        document.getElementById('progressFill').style.width = progress + '%';
      }
    }

    function getQuality(value, test) {
      if (test === 'shannon') {
        if (value >= 7.9) return { label: 'Excellent', class: 'result-good' };
        if (value >= 7.5) return { label: 'Good', class: 'result-good' };
        if (value >= 7.0) return { label: 'Fair', class: 'result-fair' };
        return { label: 'Poor', class: 'result-poor' };
      } else if (test === 'chiSquare') {
        if (value < 250) return { label: 'Excellent', class: 'result-good' };
        if (value < 293.25) return { label: 'Good', class: 'result-good' };
        if (value < 350) return { label: 'Fair', class: 'result-fair' };
        return { label: 'Poor', class: 'result-poor' };
      } else if (test === 'serialCorr') {
        if (value < 0.05) return { label: 'Excellent', class: 'result-good' };
        if (value < 0.1) return { label: 'Good', class: 'result-good' };
        if (value < 0.2) return { label: 'Fair', class: 'result-fair' };
        return { label: 'Poor', class: 'result-poor' };
      } else if (test === 'avalanche') {
        if (value >= 45 && value <= 55) return { label: 'Excellent', class: 'result-good' };
        if (value >= 40 && value <= 60) return { label: 'Good', class: 'result-good' };
        if (value >= 35 && value <= 65) return { label: 'Fair', class: 'result-fair' };
        return { label: 'Poor', class: 'result-poor' };
      } else {
        if (value <= 1.0) return { label: 'Excellent', class: 'result-good' };
        if (value <= 2.0) return { label: 'Good', class: 'result-good' };
        if (value <= 3.0) return { label: 'Fair', class: 'result-fair' };
        return { label: 'Poor', class: 'result-poor' };
      }
    }

    function compareValues(val1, val2, test) {
      if (test === 'shannon' || test === 'avalanche') {
        return Math.abs(val1 - (test === 'shannon' ? 8.0 : 50.0)) < Math.abs(val2 - (test === 'shannon' ? 8.0 : 50.0)) ? 'ntrpRNG' : 'cgRNDV';
      } else {
        return val1 < val2 ? 'ntrpRNG' : 'cgRNDV';
      }
    }

    function displaySingleResult(results, rngName, avalancheResults = null) {
      const shannonValue = parseFloat(results.shannonEntropy.value);
      const monobitValue = parseFloat(results.monobitTest.value);
      const runsValue = parseFloat(results.runsTest.value);
      const chiSquareValue = parseFloat(results.chiSquareTest.value);
      const serialCorrValue = parseFloat(results.serialCorrelationTest.value);
      
      const shannonQ = getQuality(shannonValue, 'shannon');
      const monobitQ = getQuality(monobitValue, 'other');
      const runsQ = getQuality(runsValue, 'other');
      const chiSquareQ = getQuality(chiSquareValue, 'chiSquare');
      const serialCorrQ = getQuality(serialCorrValue, 'serialCorr');
      
      let html = `
        <div class="result">
          <h3>${rngName}</h3>
          
          <div class="result-row">
            <div class="result-label">Shannon Entropy:</div>
            <div class="result-value ${shannonQ.class}">${results.shannonEntropy.value}</div>
            <div class="result-quality ${shannonQ.class}">${shannonQ.label}</div>
          </div>
          
          <div class="result-row">
            <div class="result-label">Monobit Test:</div>
            <div class="result-value ${monobitQ.class}">${results.monobitTest.value}</div>
            <div class="result-quality ${monobitQ.class}">${monobitQ.label}</div>
          </div>
          
          <div class="result-row">
            <div class="result-label">Runs Test:</div>
            <div class="result-value ${runsQ.class}">${results.runsTest.value}</div>
            <div class="result-quality ${runsQ.class}">${runsQ.label}</div>
          </div>
          
          <div class="result-row">
            <div class="result-label">Chi-Square Test:</div>
            <div class="result-value ${chiSquareQ.class}">${results.chiSquareTest.value}</div>
            <div class="result-quality ${chiSquareQ.class}">${chiSquareQ.label}</div>
          </div>
          
          <div class="result-row">
            <div class="result-label">Serial Correlation:</div>
            <div class="result-value ${serialCorrQ.class}">${results.serialCorrelationTest.value}</div>
            <div class="result-quality ${serialCorrQ.class}">${serialCorrQ.label}</div>
          </div>
      `;
      
      if (avalancheResults) {
        const avalancheValue = parseFloat(avalancheResults.meanAvalanche);
        const avalancheQ = getQuality(avalancheValue, 'avalanche');
        html += `
          <div class="result-row">
            <div class="result-label">Avalanche Effect:</div>
            <div class="result-value ${avalancheQ.class}">${avalancheResults.meanAvalanche}</div>
            <div class="result-quality ${avalancheQ.class}">${avalancheQ.label}</div>
          </div>
        `;
      }
      
      html += `
          <p style="margin-top: 15px; font-size: 12px;"><strong>Dataset:</strong> ${results.shannonEntropy.datasetSize}</p>
          <p style="font-size: 12px;"><strong>Seeds:</strong> ${results.count} | <strong>Duration:</strong> ${results.duration}</p>
        </div>
      `;
      
      return html;
    }

    function displayComparisonResult(results1, results2, avalanche1, avalanche2) {
      const s1 = parseFloat(results1.shannonEntropy.value);
      const s2 = parseFloat(results2.shannonEntropy.value);
      const m1 = parseFloat(results1.monobitTest.value);
      const m2 = parseFloat(results2.monobitTest.value);
      const r1 = parseFloat(results1.runsTest.value);
      const r2 = parseFloat(results2.runsTest.value);
      const c1 = parseFloat(results1.chiSquareTest.value);
      const c2 = parseFloat(results2.chiSquareTest.value);
      const sc1 = parseFloat(results1.serialCorrelationTest.value);
      const sc2 = parseFloat(results2.serialCorrelationTest.value);
      const a1 = parseFloat(avalanche1.meanAvalanche);
      const a2 = parseFloat(avalanche2.meanAvalanche);
      
      const sWinner = compareValues(s1, s2, 'shannon');
      const mWinner = compareValues(m1, m2, 'other');
      const rWinner = compareValues(r1, r2, 'other');
      const cWinner = compareValues(c1, c2, 'other');
      const scWinner = compareValues(sc1, sc2, 'other');
      const aWinner = compareValues(a1, a2, 'avalanche');
      
      const sq1 = getQuality(s1, 'shannon');
      const sq2 = getQuality(s2, 'shannon');
      const mq1 = getQuality(m1, 'other');
      const mq2 = getQuality(m2, 'other');
      const rq1 = getQuality(r1, 'other');
      const rq2 = getQuality(r2, 'other');
      const cq1 = getQuality(c1, 'chiSquare');
      const cq2 = getQuality(c2, 'chiSquare');
      const scq1 = getQuality(sc1, 'serialCorr');
      const scq2 = getQuality(sc2, 'serialCorr');
      const aq1 = getQuality(a1, 'avalanche');
      const aq2 = getQuality(a2, 'avalanche');
      
      const ntrpScore = (sWinner === 'ntrpRNG' ? 1 : 0) + (mWinner === 'ntrpRNG' ? 1 : 0) + 
                        (rWinner === 'ntrpRNG' ? 1 : 0) + (cWinner === 'ntrpRNG' ? 1 : 0) + 
                        (scWinner === 'ntrpRNG' ? 1 : 0) + (aWinner === 'ntrpRNG' ? 1 : 0);
      const cgScore = 6 - ntrpScore;
      
      return `
        <div class="results-comparison">
          <div class="result">
            <h3>ntrpRNG ${ntrpScore > cgScore ? '<span class="winner-badge">WINNER</span>' : ''} (${ntrpScore}/6)</h3>
            
            <div class="result-row">
              <div class="result-label">Shannon ${sWinner === 'ntrpRNG' ? 'üèÜ' : ''}:</div>
              <div class="result-value ${sq1.class}">${results1.shannonEntropy.value}</div>
              <div class="result-quality ${sq1.class}">${sq1.label}</div>
            </div>
            
            <div class="result-row">
              <div class="result-label">Monobit ${mWinner === 'ntrpRNG' ? 'üèÜ' : ''}:</div>
              <div class="result-value ${mq1.class}">${results1.monobitTest.value}</div>
              <div class="result-quality ${mq1.class}">${mq1.label}</div>
            </div>
            
            <div class="result-row">
              <div class="result-label">Runs ${rWinner === 'ntrpRNG' ? 'üèÜ' : ''}:</div>
              <div class="result-value ${rq1.class}">${results1.runsTest.value}</div>
              <div class="result-quality ${rq1.class}">${rq1.label}</div>
            </div>
            
            <div class="result-row">
              <div class="result-label">Chi-Square ${cWinner === 'ntrpRNG' ? 'üèÜ' : ''}:</div>
              <div class="result-value ${cq1.class}">${results1.chiSquareTest.value}</div>
              <div class="result-quality ${cq1.class}">${cq1.label}</div>
            </div>
            
            <div class="result-row">
              <div class="result-label">Serial Corr ${scWinner === 'ntrpRNG' ? 'üèÜ' : ''}:</div>
              <div class="result-value ${scq1.class}">${results1.serialCorrelationTest.value}</div>
              <div class="result-quality ${scq1.class}">${scq1.label}</div>
            </div>
            
            <div class="result-row">
              <div class="result-label">Avalanche ${aWinner === 'ntrpRNG' ? 'üèÜ' : ''}:</div>
              <div class="result-value ${aq1.class}">${avalanche1.meanAvalanche}</div>
              <div class="result-quality ${aq1.class}">${aq1.label}</div>
            </div>
            
            <p style="margin-top: 15px; font-size: 12px;"><strong>Duration:</strong> ${results1.duration}</p>
          </div>
          
          <div class="result">
            <h3>cgRNDV ${cgScore > ntrpScore ? '<span class="winner-badge">WINNER</span>' : ''} (${cgScore}/6)</h3>
            
            <div class="result-row">
              <div class="result-label">Shannon ${sWinner === 'cgRNDV' ? 'üèÜ' : ''}:</div>
              <div class="result-value ${sq2.class}">${results2.shannonEntropy.value}</div>
              <div class="result-quality ${sq2.class}">${sq2.label}</div>
            </div>
            
            <div class="result-row">
              <div class="result-label">Monobit ${mWinner === 'cgRNDV' ? 'üèÜ' : ''}:</div>
              <div class="result-value ${mq2.class}">${results2.monobitTest.value}</div>
              <div class="result-quality ${mq2.class}">${mq2.label}</div>
            </div>
            
            <div class="result-row">
              <div class="result-label">Runs ${rWinner === 'cgRNDV' ? 'üèÜ' : ''}:</div>
              <div class="result-value ${rq2.class}">${results2.runsTest.value}</div>
              <div class="result-quality ${rq2.class}">${rq2.label}</div>
            </div>
            
            <div class="result-row">
              <div class="result-label">Chi-Square ${cWinner === 'cgRNDV' ? 'üèÜ' : ''}:</div>
              <div class="result-value ${cq2.class}">${results2.chiSquareTest.value}</div>
              <div class="result-quality ${cq2.class}">${cq2.label}</div>
            </div>
            
            <div class="result-row">
              <div class="result-label">Serial Corr ${scWinner === 'cgRNDV' ? 'üèÜ' : ''}:</div>
              <div class="result-value ${scq2.class}">${results2.serialCorrelationTest.value}</div>
              <div class="result-quality ${scq2.class}">${scq2.label}</div>
            </div>
            
            <div class="result-row">
              <div class="result-label">Avalanche ${aWinner === 'cgRNDV' ? 'üèÜ' : ''}:</div>
              <div class="result-value ${aq2.class}">${avalanche2.meanAvalanche}</div>
              <div class="result-quality ${aq2.class}">${aq2.label}</div>
            </div>
            
            <p style="margin-top: 15px; font-size: 12px;"><strong>Duration:</strong> ${results2.duration}</p>
          </div>
        </div>
      `;
    }

    async function runTest() {
      const btn = document.getElementById('startBtn');
      const datasetKB = parseInt(document.getElementById('datasetSize').value) || 64;
      const iterations = parseInt(document.getElementById('iterations').value) || 5000;
      const saltSize = parseInt(document.getElementById('saltSize').value) || 32;
      
      if (datasetKB < 1 || datasetKB > 10240) {
        alert('Dataset size must be between 1 KB and 10240 KB (10 MB)');
        return;
      }
      
      btn.disabled = true;
      document.getElementById('resultContainer').innerHTML = '';
      
      try {
        const datasetBytes = datasetKB * 1024;
        const seedSize = 64;
        const seedCount = Math.ceil(datasetBytes / seedSize);
        const avalancheIterations = Math.min(25, Math.ceil(seedCount / 10));
        
        if (currentMode === 'ntrpRNG' || currentMode === 'both') {
          updateStatus('Testing ntrpRNG', 'Initializing...', 5);
          
          const rng1 = new ntrpRNG({ 
            minEvents: 500,
            autoCollect: true,
            iterations: iterations,
            saltSize: saltSize
          });
          const dev1 = new ntrpRNGDev(rng1);
          
          const collector = document.getElementById('entropyCollector');
          collector.classList.add('active');
          
          const TARGET_EVENTS = 500;
          let startTime = Date.now();
          let lastEventCount = 0;
          
          const monitorInterval = setInterval(() => {
            const progress = rng1.getProgress();
            const stats = rng1.getStats();
            const weightedEvents = progress.currentEvents;
            const percentage = progress.percentage;
            
            document.getElementById('entropyBarFill').style.width = percentage + '%';
            document.getElementById('entropyBarText').textContent = `${weightedEvents} / ${TARGET_EVENTS}`;
            
            document.getElementById('eventKeyboard').textContent = stats.eventCount.keyboard;
            document.getElementById('eventMouse').textContent = stats.eventCount.mouse;
            document.getElementById('eventTouch').textContent = stats.eventCount.touch;
            document.getElementById('eventScroll').textContent = stats.eventCount.scroll;
            document.getElementById('eventOther').textContent = stats.eventCount.other;
            
            document.getElementById('entropyWeighted').textContent = weightedEvents;
            
            const elapsed = (Date.now() - startTime) / 1000;
            const currentRate = Math.round(weightedEvents / elapsed);
            document.getElementById('entropyRate').textContent = currentRate;
            
            const remaining = TARGET_EVENTS - weightedEvents;
            let eta = '~0s';
            if (currentRate > 0 && remaining > 0) {
              const seconds = Math.ceil(remaining / currentRate);
              eta = `~${seconds}s`;
            }
            document.getElementById('entropyETA').textContent = eta;
            
            const message = document.getElementById('entropyMessage');
            if (weightedEvents >= TARGET_EVENTS) {
              message.textContent = '‚úì Entropy pool filled! Processing...';
              message.className = 'entropy-message good';
            } else if (stats.eventCount.keyboard > 50) {
              message.textContent = 'üî• Excellent! Keyboard events are most efficient (√ó3)';
              message.className = 'entropy-message good';
            } else if (currentRate > 50) {
              message.textContent = 'üëç Good rate! Keep interacting!';
              message.className = 'entropy-message';
            } else if (currentRate > 0) {
              message.textContent = 'üí° Tip: Use keyboard for fastest collection (√ó3 weight)';
              message.className = 'entropy-message';
            } else {
              message.textContent = '‚óè Start interacting with the page!';
              message.className = 'entropy-message';
            }
            
            lastEventCount = weightedEvents;
          }, 100);
          
          updateStatus(
            'Collecting Entropy (ntrpRNG)',
            '<span class="spinner"></span> Collecting 500 weighted events...',
            15
          );
          
          await new Promise((resolve) => {
            const checkInterval = setInterval(() => {
              const progress = rng1.getProgress();
              if (progress.ready) {
                clearInterval(checkInterval);
                clearInterval(monitorInterval);
                resolve();
              }
            }, 100);
          });
          
          updateStatus(
            'Entropy Collection Complete',
            '‚úì Full entropy pool collected (500 weighted events)!',
            25
          );
          
          await new Promise(resolve => setTimeout(resolve, 1000));
          
          updateStatus(
            'Running Tests (ntrpRNG)',
            `<span class="spinner"></span> Generating ${seedCount} seeds and testing...`,
            currentMode === 'both' ? 30 : 40
          );
          
          const results1 = await dev1.runMultiSeedTest(seedCount, seedSize, true);
          
          updateStatus(
            'Running Avalanche Test (ntrpRNG)',
            `<span class="spinner"></span> Testing bit-flip propagation...`,
            currentMode === 'both' ? 40 : 70
          );
          
          const avalanche1 = await dev1.testAvalancheEffect(avalancheIterations);
          
          rng1.stopCollecting();
          
          if (currentMode === 'ntrpRNG') {
            updateStatus('Complete', 'Test completed!', 100);
            document.getElementById('resultContainer').innerHTML = displaySingleResult(results1, 'ntrpRNG', avalanche1);
          } else {
            window.results1 = results1;
            window.avalanche1 = avalanche1;
          }
        }
        
        if (currentMode === 'cgRNDV' || currentMode === 'both') {
          updateStatus('Testing cgRNDV', 'Initializing...', currentMode === 'both' ? 50 : 5);
          
          const rng2 = new cgRNDV({ 
            iterations: iterations,
            saltSize: saltSize
          });
          const dev2 = new ntrpRNGDev(rng2);
          
          updateStatus(
            'Running Tests (cgRNDV)',
            `<span class="spinner"></span> Generating ${seedCount} seeds and testing...`,
            currentMode === 'both' ? 60 : 40
          );
          
          const results2 = await dev2.runMultiSeedTest(seedCount, seedSize, true);
          
          updateStatus(
            'Running Avalanche Test (cgRNDV)',
            `<span class="spinner"></span> Testing bit-flip propagation...`,
            currentMode === 'both' ? 80 : 70
          );
          
          const avalanche2 = await dev2.testAvalancheEffect(avalancheIterations);
          
          if (currentMode === 'cgRNDV') {
            updateStatus('Complete', 'Test completed!', 100);
            document.getElementById('resultContainer').innerHTML = displaySingleResult(results2, 'cgRNDV', avalanche2);
          } else {
            updateStatus('Complete', 'Comparison finished!', 100);
            document.getElementById('resultContainer').innerHTML = displayComparisonResult(
              window.results1, 
              results2, 
              window.avalanche1, 
              avalanche2
            );
          }
        }
        
      } catch (error) {
        updateStatus('Error', `Test failed: ${error.message}`, 0);
        console.error(error);
      } finally {
        btn.disabled = false;
        document.getElementById('entropyCollector').classList.remove('active');
      }
    }

    function toggleInfoBox() {
      document.getElementById('infoBox').classList.toggle('open');
    }
  </script>
</body>
</html> 